import React, { useState, useEffect, useRef } from 'react';
import { Phone, ArrowRight, Instagram, Facebook, Twitter, Menu, X, MessageCircle, ChevronDown } from 'lucide-react';

// --- Reusable Animation Wrapper ---
const Reveal = ({ children, className = "", delay = 0 }) => {
  const [isVisible, setIsVisible] = useState(false);
  const ref = useRef(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.unobserve(entry.target);
        }
      },
      { threshold: 0.1 }
    );
    if (ref.current) observer.observe(ref.current);
    return () => observer.disconnect();
  }, []);

  return (
    <div
      ref={ref}
      style={{ transitionDelay: `${delay}ms` }}
      className={`transition-all duration-1000 ease-out transform ${
        isVisible ? "opacity-100 translate-y-0" : "opacity-0 translate-y-12"
      } ${className}`}
    >
      {children}
    </div>
  );
};

const QilanFurniture = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [scrolled, setScrolled] = useState(false);
  const [activeSlide, setActiveSlide] = useState(0);

  // Scroll listener
  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 50);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const phoneNumber = "250784625038";
  const displayPhone = "+250 784 625 038";

  const products = [
    {
      id: 1,
      image: "https://i.imgur.com/ojxwZyV.jpeg",
      name: "The Sovereign",
      category: "Signature Series",
      description: "A masterclass in comfort. Designed for those who command the room."
    },
    {
      id: 2,
      image: "https://i.imgur.com/CAgNXrW.jpeg",
      name: "Cloud Velvet",
      category: "Luxe Living",
      description: "Softness that defies gravity. Structured elegance meets plush reality."
    },
    {
      id: 3,
      image: "https://i.imgur.com/JKxFuqI.jpeg",
      name: "Nordic Silhouette",
      category: "Modern Accent",
      description: "Minimalism isn't about having less. It's about making room for more of what matters."
    },
    {
      id: 4,
      image: "https://i.imgur.com/lBPtXCG.jpeg",
      name: "Royal Banquet",
      category: "Dining Collection",
      description: "Where every meal transforms into a grand occasion."
    },
    {
      id: 5,
      image: "https://i.imgur.com/xRoDm2G.jpeg",
      name: "The Lounge Suite",
      category: "Comfort Series",
      description: "Deep seating designed for the ultimate decompression."
    },
    {
      id: 6,
      image: "https://i.imgur.com/v7UHiO7.jpeg",
      name: "Modular Flow",
      category: "Adaptive Living",
      description: "Luxury that adapts to your changing space and mood."
    },
    {
      id: 7,
      image: "https://i.imgur.com/q1aTVyc.jpeg",
      name: "Gilded Ottoman",
      category: "Finishing Touches",
      description: "The golden accent that completes the visual symphony."
    }
  ];

  const handleWhatsApp = (productName = "") => {
    let message = "Hello, I'm captivated by the Qilan collection.";
    if (productName) message += ` Specifically interested in the ${productName}.`;
    window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank');
  };

  return (
    <div className="min-h-screen bg-[#0a0a0a] text-stone-200 font-sans selection:bg-white selection:text-black overflow-x-hidden">
      {/* Dynamic Styles */}
      <style dangerouslySetInnerHTML={{__html: `
        @import url('https://fonts.googleapis.com/css2?family=Italiana&family=Manrope:wght@200;300;400;500;600&display=swap');
        
        .font-display { fontFamily: 'Italiana', serif; }
        .font-body { fontFamily: 'Manrope', sans-serif; }
        
        .ken-burns {
          animation: kenBurns 20s infinite alternate;
        }
        
        @keyframes kenBurns {
          0% { transform: scale(1); }
          100% { transform: scale(1.15); }
        }

        .text-outline {
          -webkit-text-stroke: 1px rgba(255,255,255,0.3);
          color: transparent;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
      `}} />

      {/* Floating WhatsApp Button */}
      <button 
        onClick={() => handleWhatsApp()}
        className="fixed bottom-8 right-8 z-50 bg-[#333] border border-stone-700 text-white p-4 rounded-full shadow-2xl hover:bg-stone-700 transition-transform duration-300 hover:scale-110 hover:rotate-12 group"
        aria-label="Chat on WhatsApp"
      >
        <MessageCircle size={32} className="fill-current" />
        <span className="absolute right-full mr-4 top-1/2 -translate-y-1/2 bg-[#222] text-stone-200 px-4 py-2 rounded-lg shadow-lg text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap pointer-events-none border border-stone-800">
          Chat with us
        </span>
        <span className="absolute -top-1 -right-1 w-4 h-4 bg-stone-500 rounded-full animate-ping"></span>
        <span className="absolute -top-1 -right-1 w-4 h-4 bg-stone-500 rounded-full border-2 border-[#333]"></span>
      </button>

      {/* Navbar */}
      <nav className={`fixed w-full z-40 transition-all duration-500 ${scrolled ? 'bg-[#0a0a0a]/90 backdrop-blur-xl py-4 shadow-sm border-b border-white/5' : 'bg-transparent py-8'}`}>
        <div className="container mx-auto px-6 md:px-12 flex justify-between items-center">
          <a href="#" className="relative z-50 text-3xl md:text-4xl font-display tracking-widest text-stone-200">
            QILAN
          </a>
          
          <div className="hidden md:flex items-center space-x-12 text-stone-200">
            <a href="#gallery" className="text-sm font-bold tracking-[0.2em] hover:text-stone-500 transition-colors uppercase">Gallery</a>
            <a href="#vision" className="text-sm font-bold tracking-[0.2em] hover:text-stone-500 transition-colors uppercase">Vision</a>
            <a href="#contact" className="text-sm font-bold tracking-[0.2em] hover:text-stone-500 transition-colors uppercase">Contact</a>
          </div>

          <button className="md:hidden relative z-50 text-stone-200" onClick={() => setIsMenuOpen(!isMenuOpen)}>
            {isMenuOpen ? <X size={32} /> : <Menu size={32} />}
          </button>
        </div>
      </nav>

      {/* Fullscreen Mobile Menu */}
      <div className={`fixed inset-0 bg-[#050505] z-30 transition-transform duration-700 ease-[cubic-bezier(0.76,0,0.24,1)] ${isMenuOpen ? 'translate-y-0' : '-translate-y-full'}`}>
        <div className="h-full flex flex-col items-center justify-center space-y-8">
          <a href="#gallery" onClick={() => setIsMenuOpen(false)} className="text-5xl font-display text-stone-300 hover:text-white transition-colors">Gallery</a>
          <a href="#vision" onClick={() => setIsMenuOpen(false)} className="text-5xl font-display text-stone-300 hover:text-white transition-colors">Vision</a>
          <a href="#contact" onClick={() => setIsMenuOpen(false)} className="text-5xl font-display text-stone-300 hover:text-white transition-colors">Contact</a>
        </div>
      </div>

      {/* Hero Section */}
      <header className="relative h-screen w-full overflow-hidden bg-[#0a0a0a]">
        <div className="absolute inset-0 opacity-40">
           <img 
            src={products[0].image} 
            className="w-full h-full object-cover ken-burns grayscale"
            alt="Hero Background"
          />
        </div>
        <div className="absolute inset-0 bg-gradient-to-b from-[#0a0a0a]/30 via-[#0a0a0a]/60 to-[#0a0a0a]" />
        
        <div className="absolute inset-0 flex flex-col items-center justify-center text-center px-4 z-10 mt-12">
          <Reveal>
            <p className="text-stone-400 text-sm md:text-base tracking-[0.5em] uppercase mb-4 font-bold">Kigali, Rwanda</p>
          </Reveal>
          <Reveal delay={200}>
            <h1 className="text-6xl md:text-9xl font-display text-stone-200 mb-6 leading-[0.85] tracking-tight">
              ART OF <br/> <span className="italic text-stone-500">LIVING</span>
            </h1>
          </Reveal>
          <Reveal delay={400}>
            <p className="text-stone-400 max-w-lg mx-auto font-body font-light text-lg md:text-xl leading-relaxed mb-12">
              We don't just sell furniture. We curate the backdrop of your life's most important moments.
            </p>
          </Reveal>
          <Reveal delay={600}>
            <div className="flex flex-col md:flex-row gap-6">
              <button 
                onClick={() => document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' })}
                className="px-10 py-4 border border-stone-600 text-stone-200 font-bold tracking-widest hover:bg-stone-800 transition-colors"
              >
                VIEW GALLERY
              </button>
            </div>
          </Reveal>
        </div>

        <div className="absolute bottom-10 left-1/2 -translate-x-1/2 animate-bounce text-stone-600">
          <ChevronDown size={32} />
        </div>
      </header>

      {/* Vision / Intro */}
      <section id="vision" className="py-32 bg-[#0a0a0a] text-stone-200 relative overflow-hidden">
        <div className="container mx-auto px-6 relative z-10">
          <div className="flex flex-col md:flex-row items-end gap-12 md:gap-24">
            <div className="md:w-2/3">
              <Reveal>
                <h2 className="text-5xl md:text-8xl font-display leading-[0.9] text-stone-300">
                  FURNITURE <br/> THAT SPEAKS <br/> <span className="text-stone-700">WITHOUT WORDS.</span>
                </h2>
              </Reveal>
            </div>
            <div className="md:w-1/3 pb-4">
              <Reveal delay={300}>
                <p className="font-body text-stone-500 text-lg leading-relaxed mb-8 border-l border-stone-800 pl-6">
                  Qilan isn't for everyone. It's for the discerning few who understand that a chair is never just a chair. It's an invitation.
                </p>
                <button onClick={() => handleWhatsApp()} className="text-stone-300 border-b border-stone-600 pb-1 hover:text-white hover:border-white transition-colors uppercase tracking-widest text-sm font-bold">
                  Speak to a Designer
                </button>
              </Reveal>
            </div>
          </div>
        </div>
        {/* Decorative giant text */}
        <div className="absolute -bottom-20 -right-20 text-[20rem] font-display text-white/[0.02] pointer-events-none select-none hidden md:block">
          QILAN
        </div>
      </section>

      {/* The Gallery - Asymmetrical/Editorial Layout */}
      <section id="gallery" className="bg-[#111] py-32">
        <div className="container mx-auto px-6">
          <Reveal className="mb-24 text-center">
             <span className="text-stone-500 uppercase tracking-[0.4em] text-xs font-bold">The Collection</span>
             <h3 className="text-4xl md:text-5xl font-display mt-4 text-stone-200">Curated Masterpieces</h3>
          </Reveal>

          <div className="space-y-32">
            {products.map((item, index) => (
              <div key={item.id} className={`flex flex-col ${index % 2 === 0 ? 'md:flex-row' : 'md:flex-row-reverse'} items-center gap-12 md:gap-24 group`}>
                
                {/* Image Side */}
                <div className="w-full md:w-1/2 relative">
                  <Reveal>
                    <div className="relative overflow-hidden aspect-[4/5] md:aspect-[3/4]">
                      <div className="absolute inset-0 bg-black/40 z-10 group-hover:bg-transparent transition-colors duration-500"/>
                      <img 
                        src={item.image} 
                        alt={item.name} 
                        className="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-[1.5s] ease-[cubic-bezier(0.25,1,0.5,1)] grayscale group-hover:grayscale-0"
                      />
                      {/* Floating Category Tag */}
                      <div className="absolute top-6 left-6 z-20 bg-black/80 backdrop-blur-sm px-4 py-2 text-xs font-bold tracking-widest uppercase text-stone-300 border border-stone-800">
                        {item.category}
                      </div>
                    </div>
                  </Reveal>
                </div>

                {/* Text Side */}
                <div className="w-full md:w-1/2 text-center md:text-left px-4 md:px-0">
                  <Reveal delay={200}>
                    <h3 className="text-4xl md:text-6xl font-display text-stone-200 mb-6 group-hover:italic transition-all">
                      {item.name}
                    </h3>
                    <p className="text-stone-500 font-body text-lg leading-relaxed mb-8 max-w-md mx-auto md:mx-0">
                      {item.description}
                    </p>
                    <div className="flex flex-col md:flex-row gap-6 justify-center md:justify-start items-center">
                      <button 
                        onClick={() => handleWhatsApp(item.name)}
                        className="group/btn flex items-center gap-4 text-stone-300 font-bold tracking-widest uppercase text-sm"
                      >
                        <span className="border-b border-stone-600 pb-1 group-hover/btn:border-stone-300 transition-colors">Inquire Availability</span>
                        <ArrowRight className="group-hover/btn:translate-x-2 transition-transform" size={18} />
                      </button>
                    </div>
                  </Reveal>
                </div>

              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Marquee Section */}
      <section className="bg-[#050505] py-8 overflow-hidden whitespace-nowrap border-y border-stone-900">
        <div className="inline-block animate-[marquee_20s_linear_infinite] text-stone-800 font-display text-6xl md:text-8xl mx-4">
          TIMELESS ELEGANCE — MODERN COMFORT — QILAN SIGNATURE — 
        </div>
        <div className="inline-block animate-[marquee_20s_linear_infinite] text-stone-800 font-display text-6xl md:text-8xl mx-4">
          TIMELESS ELEGANCE — MODERN COMFORT — QILAN SIGNATURE — 
        </div>
        <style>{`
          @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
          }
        `}</style>
      </section>

      {/* Final CTA / Footer */}
      <footer id="contact" className="bg-[#0a0a0a] text-stone-300 pt-32 pb-12">
        <div className="container mx-auto px-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-16 mb-24 border-b border-stone-800 pb-16">
            <div className="space-y-8">
               <h2 className="text-6xl md:text-8xl font-display text-stone-200">QILAN</h2>
               <p className="text-stone-500 max-w-sm font-body">
                 Redefining the Rwandan interior landscape, one masterpiece at a time.
               </p>
               <div className="flex gap-6">
                 <a href="#" className="w-12 h-12 rounded-full border border-stone-800 flex items-center justify-center hover:bg-stone-800 text-stone-500 hover:text-stone-200 transition-all duration-300"><Instagram size={20} /></a>
                 <a href="#" className="w-12 h-12 rounded-full border border-stone-800 flex items-center justify-center hover:bg-stone-800 text-stone-500 hover:text-stone-200 transition-all duration-300"><Facebook size={20} /></a>
                 <a href="#" className="w-12 h-12 rounded-full border border-stone-800 flex items-center justify-center hover:bg-stone-800 text-stone-500 hover:text-stone-200 transition-all duration-300"><Twitter size={20} /></a>
               </div>
            </div>
            
            <div className="flex flex-col justify-end items-start md:items-end">
               <p className="text-stone-600 uppercase tracking-widest text-sm font-bold mb-4">Contact Direct</p>
               <a href={`tel:${phoneNumber}`} className="text-3xl md:text-5xl font-display hover:text-white transition-colors mb-8 text-stone-300">
                 {displayPhone}
               </a>
               <button 
                  onClick={() => handleWhatsApp()}
                  className="px-8 py-4 bg-stone-200 text-[#0a0a0a] font-bold tracking-widest hover:bg-white transition-colors w-full md:w-auto text-center"
               >
                 START A PROJECT
               </button>
            </div>
          </div>
          
          <div className="flex flex-col md:flex-row justify-between items-center text-stone-600 text-xs font-bold tracking-widest uppercase">
            <p>&copy; 2024 QILAN FURNITURE.</p>
            <p className="mt-4 md:mt-0">Crafted in Rwanda.</p>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default QilanFurniture;
